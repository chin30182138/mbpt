<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä»™äººæŒ‡è·¯ - V70.0 (å¤©æ™‚æ­£å®—â€§ä¸€éµå­˜åœ–ç‰ˆ)</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        :root {
            --bg: #050505;
            --card-bg: #141414;
            --gold: #d4af37;
            --gold-light: #f1c40f;
            --blue: #2980b9;
            --text: #eee;
        }
        body {
            font-family: "Microsoft JhengHei", "Heiti TC", serif;
            background-color: var(--bg); color: var(--text);
            margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        /* --- 1. é¦–é  --- */
        #landing { text-align: center; padding: 40px 20px; width: 100%; max-width: 400px; }
        .logo { width: 120px; margin-bottom: 20px; filter: drop-shadow(0 0 10px rgba(212,175,55,0.4)); }
        .title { font-size: 32px; font-weight: 900; color: var(--gold); margin-bottom: 5px; letter-spacing: 2px; }
        .sub { font-size: 14px; color: #888; margin-bottom: 40px; }
        
        .date-badge { 
            background: #222; border: 1px solid #444; color: var(--gold); 
            padding: 8px 15px; border-radius: 20px; font-size: 14px; margin-bottom: 30px; display: inline-block;
        }

        .btn-main {
            background: linear-gradient(135deg, #b8860b, #d4af37);
            color: #000; font-size: 20px; font-weight: bold;
            padding: 15px 50px; border: none; border-radius: 50px;
            cursor: pointer; box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
            animation: pulse 2s infinite; width: 100%;
        }
        .btn-main:active { transform: scale(0.98); }

        /* --- 2. çµæœé¡¯ç¤ºå€ --- */
        #result-area { display: none; padding: 20px; width: 100%; max-width: 400px; }

        /* é€™å¼µå¡ç‰‡æ˜¯è¦è¢«æˆªåœ–çš„å€åŸŸ */
        #capture-card {
            background: var(--card-bg); 
            border: 2px solid var(--gold);
            border-radius: 20px; 
            padding: 30px 20px; 
            text-align: center;
            position: relative; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            /* åŠ ä¸ŠèƒŒæ™¯ç´‹ç†ï¼Œå¢åŠ è³ªæ„Ÿ */
            background-image: radial-gradient(circle at 50% 0%, #2a2a2a 0%, #141414 70%);
        }

        .card-header img { height: 40px; opacity: 0.8; margin-bottom: 10px; }
        
        .beast-avatar {
            width: 140px; height: 140px; margin: 0 auto 15px auto;
            border: 3px solid var(--gold); border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 60px; background: #000;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
        }

        .r-name { 
            font-size: 36px; font-weight: 900; color: var(--gold); 
            margin: 5px 0; font-family: "KaiTi", serif; letter-spacing: 2px;
        }
        .r-meta { font-size: 13px; color: #888; margin-bottom: 20px; letter-spacing: 1px; text-transform: uppercase; }
        .r-meta span { color: var(--gold); margin: 0 5px; }

        .r-desc-box { 
            text-align: left; background: rgba(255,255,255,0.05); 
            padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 3px solid var(--gold);
        }
        .r-title { color: var(--gold); font-size: 13px; font-weight: bold; margin-bottom: 5px; }
        .r-text { font-size: 14px; color: #ddd; line-height: 1.5; }

        .r-guide { 
            font-size: 16px; font-weight: bold; color: #fff; font-style: italic; 
            margin-top: 20px; padding-top: 15px; border-top: 1px dashed #444;
        }

        .card-footer { margin-top: 25px; font-size: 11px; color: #555; }

        /* æŒ‰éˆ•å€ */
        .action-bar { margin-top: 25px; display: flex; gap: 10px; }
        .btn-download {
            flex: 2; background: #fff; color: #000; border: none; padding: 12px;
            font-weight: bold; border-radius: 10px; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 5px;
        }
        .btn-retry {
            flex: 1; background: transparent; border: 1px solid #555; color: #888;
            padding: 12px; border-radius: 10px; cursor: pointer;
        }

        /* è®€å–å‹•ç•« */
        #loading { display: none; margin-top: 50px; text-align: center; }
        .spinner { width: 40px; height: 40px; border: 4px solid #333; border-top: 4px solid var(--gold); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(212,175,55,0.4); } 70% { box-shadow: 0 0 0 15px rgba(212,175,55,0); } 100% { box-shadow: 0 0 0 0 rgba(212,175,55,0); } }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="landing">
        <img src="logo.png" alt="Logo" class="logo">
        <div class="title">ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼</div>
        <div class="sub">ä»™äººæŒ‡è·¯ Â· æ¸¬æ¸¬ä½ çš„æœ¬å‘½å®ˆè­·ç¥</div>
        
        <div class="date-badge" id="todayInfo">è¼‰å…¥æ—¥æœŸä¸­...</div>

        <button class="btn-main" onclick="startTest()">ğŸ”® ç«‹å³æ¸¬é©—æ€§æ ¼</button>
        <p style="margin-top:20px; font-size:12px; color:#555;">ä»Šæ—¥å·²æœ‰ 892 äººé ˜å–æŒ‡å¼•</p>
    </div>

    <div id="loading">
        <div class="spinner"></div>
        <p style="color:var(--gold);">æ­£åœ¨é€£çµå¤©æ™‚ç£å ´...</p>
    </div>

    <div id="result-area">
        <div id="capture-card">
            <div class="card-header"><img src="logo.png"></div>
            
            <div class="beast-avatar" id="rIcon">ğŸ²</div>
            <h1 class="r-name" id="rName">æ»„æµ·é’é¾</h1>
            <div class="r-meta">
                æ—¥å¹² <span id="rDayGan">ç”²</span> Ã— ä¸–çˆ» <span id="rBranch">å­(æ°´)</span>
            </div>

            <div class="r-desc-box">
                <div class="r-title">ã€æ€§æ ¼åŸå‹ã€‘</div>
                <div class="r-text" id="rDesc">
                    å¦‚æ·±æ½›æ–¼æ»„æµ·ä¹‹ä¸­çš„é¾ï¼Œå¤–è¡¨å¹³éœï¼Œå…§å¿ƒæ¹§å‹•è‘—å¼·å¤§èƒ½é‡ã€‚å–„æ–¼è§€å¯Ÿå±€å‹¢ï¼Œç­‰å¾…æ™‚æ©Ÿä¸€é£›æ²–å¤©ã€‚
                </div>
            </div>

            <div class="r-desc-box" style="border-left-color:var(--blue); background:rgba(41, 128, 185, 0.1);">
                <div class="r-title" style="color:var(--blue);">ã€ä»™äººæŒ‡è·¯ã€‘</div>
                <div class="r-text" id="rAdvice">
                    æ°´èƒ½è¼‰èˆŸäº¦èƒ½è¦†èˆŸã€‚ä½ çš„æ™ºæ…§æ˜¯é›™é¢åˆƒï¼Œå¤šä¸€é»çœŸèª ï¼Œé‹å‹¢å°‡å¦‚æµ·ç´ç™¾å·ã€‚
                </div>
            </div>

            <div class="r-guide" id="rQuote">ã€Œæ½›é¾å‹¿ç”¨ï¼Œé™½æ°£æ½›è—ã€‚ã€</div>
            
            <div class="card-footer">
                ä»™äººæŒ‡è·¯å åœç ”ç©¶å­¸æœƒ Â· é˜¿é’å¸«è¦ªæ‰¹<br>
                <span id="rDate">2026.01.06</span>
            </div>
        </div>

        <div class="action-bar">
            <button class="btn-retry" onclick="location.reload()">â†º é‡æ¸¬</button>
            <button class="btn-download" onclick="downloadCard()">ğŸ“¥ ä¸‹è¼‰ç¥ç¸å¡</button>
        </div>
    </div>

<script>
    // --- 1. å¤©æ™‚ç³»çµ± (è‡ªå‹•æŠ“æ—¥å¹²) ---
    const stems = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
    const branches = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
    const animals = ["é’é¾","æœ±é›€","å‹¾é™³","è£è›‡","ç™½è™","ç„æ­¦"];
    
    // äº”è¡Œå®šç¾©
    const wxMap = {
        "å­":"æ°´", "äº¥":"æ°´",
        "å¯…":"æœ¨", "å¯":"æœ¨",
        "å·³":"ç«", "åˆ":"ç«",
        "è¾°":"æ¿•åœŸ", "æˆŒ":"ç‡¥åœŸ", "ä¸‘":"æ¿•åœŸ", "æœª":"ç‡¥åœŸ", // ç´°åˆ†åœŸ
        "ç”³":"é‡‘", "é…‰":"é‡‘"
    };

    let todayGan = ""; 
    let todayStr = "";

    function initDate() {
        const now = new Date();
        const y = now.getFullYear();
        const m = now.getMonth() + 1;
        const d = now.getDate();
        
        // ç°¡æ˜“æ—¥å¹²æ”¯å…¬å¼ (åŸºæº– 2024/1/1 = ç”²å­)
        const base = new Date(2024, 0, 1);
        const diff = Math.round((new Date(y, m-1, d) - base) / 86400000);
        let idx = diff % 60; if(idx < 0) idx += 60;
        
        todayGan = stems[idx % 10]; // å–å¾—ä»Šæ—¥å¤©å¹²
        const todayZhi = branches[idx % 12];
        
        todayStr = `${y}.${String(m).padStart(2,'0')}.${String(d).padStart(2,'0')}`;
        document.getElementById('todayInfo').innerText = `ğŸ“… ä»Šæ—¥å¤©æ™‚ï¼š${todayGan}${todayZhi}æ—¥`;
        document.getElementById('rDate').innerText = todayStr;
    }

    // --- 2. é›…åè³‡æ–™åº« (72å‹ç”Ÿæˆé‚è¼¯) ---
    // é‚è¼¯ï¼š[ç¥ç¸][äº”è¡Œ] -> é›…å
    const nameDB = {
        "é’é¾": { "æ°´":"æ»„æµ·é’é¾", "æ¿•åœŸ":"ç›¤é¾è‡¥é‡", "ç‡¥åœŸ":"é®å±±é’é¾", "æœ¨":"é›²æ—é’é¾", "ç«":"é¨°é›²é’é¾", "é‡‘":"åŠè„Šé’é¾" },
        "æœ±é›€": { "æ°´":"æ˜ æ³¢æœ±é›€", "æ¿•åœŸ":"æ£²æ¢§æœ±é›€", "ç‡¥åœŸ":"ä¸¹å±±æœ±é›€", "æœ¨":"éŠœææœ±é›€", "ç«":"æ¶…æ§ƒæœ±é›€", "é‡‘":"æµé‡‘æœ±é›€" },
        "å‹¾é™³": { "æ°´":"æ·±æ½­å‹¾é™³", "æ¿•åœŸ":"åšå¾·å‹¾é™³", "ç‡¥åœŸ":"é®å¶½å‹¾é™³", "æœ¨":"å¤æœ¨å‹¾é™³", "ç«":"ç…‰åœŸå‹¾é™³", "é‡‘":"æŠ«ç”²å‹¾é™³" },
        "è£è›‡": { "æ°´":"é›²éœ§è£è›‡", "æ¿•åœŸ":"éåœ°è£è›‡", "ç‡¥åœŸ":"è’æ¼ è£è›‡", "æœ¨":"ç¿ æ—è£è›‡", "ç«":"å¹»ç«è£è›‡", "é‡‘":"é‡‘é±—è£è›‡" },
        "ç™½è™": { "æ°´":"éœœé›ªç™½è™", "æ¿•åœŸ":"ä¼é‡ç™½è™", "ç‡¥åœŸ":"æ› é‡ç™½è™", "æœ¨":"ä¼æ—ç™½è™", "ç«":"çƒˆç„°ç™½è™", "é‡‘":"è‚…æ®ºç™½è™" },
        "ç„æ­¦": { "æ°´":"æ·±æ·µç„æ­¦", "æ¿•åœŸ":"ç„å†¥ç„æ­¦", "ç‡¥åœŸ":"å²©ç”²ç„æ­¦", "æœ¨":"éš±æ—ç„æ­¦", "ç«":"é™°ç«ç„æ­¦", "é‡‘":"éµå£ç„æ­¦" }
    };

    const descDB = {
        "æ°´": "æ“æœ‰å¦‚æ°´èˆ¬çš„é©æ‡‰åŠ›ï¼Œå–„æ–¼æ‡‰å°è®ŠåŒ–ï¼Œæ™ºæ…§æ·±æ²‰ä½†æœ‰æ™‚æ€æ…®éé‡ã€‚",
        "æ¿•åœŸ": "æ€§æ ¼æº«æ½¤åŒ…å®¹ï¼Œå–„æ–¼æ»‹é¤Šä»–äººï¼Œä½†æœ‰æ™‚éæ–¼è¢«å‹•ã€‚",
        "ç‡¥åœŸ": "æ€§æ ¼å …æ¯…ç©©é‡ï¼ŒåŸå‰‡æ€§å¼·ï¼Œå€¼å¾—ä¿¡è³´ä½†ç¨é¡¯å›ºåŸ·ã€‚",
        "æœ¨": "å……æ»¿ç”Ÿæ©Ÿèˆ‡ä»æ„›ä¹‹å¿ƒï¼Œç©æ¥µå‘ä¸Šï¼Œå…·æœ‰é–‹å‰µåŠ›ã€‚",
        "ç«": "æ•£ç™¼å…‰èˆ‡ç†±ï¼Œå…·æœ‰å¼·çƒˆæ„ŸæŸ“åŠ›ï¼Œç†±æƒ…å¥”æ”¾ä½†æƒ…ç·’èµ·ä¼å¤§ã€‚",
        "é‡‘": "é¢¨æ ¼çŠ€åˆ©æœæ–·ï¼ŒåŸ·è¡ŒåŠ›å¼·ï¼Œè¬›æ±‚æ•ˆç‡èˆ‡åŸå‰‡ã€‚"
    };

    const iconDB = {"é’é¾":"ğŸ‰", "æœ±é›€":"ğŸ¦…", "å‹¾é™³":"â›°ï¸", "è£è›‡":"ğŸ", "ç™½è™":"ğŸ¯", "ç„æ­¦":"ğŸ¢"};

    // --- 3. æ¸¬é©—é‚è¼¯ ---
    function startTest() {
        document.getElementById('landing').style.display = 'none';
        document.getElementById('loading').style.display = 'block';
        setTimeout(calcResult, 1500);
    }

    function calcResult() {
        // 1. éš¨æ©Ÿèµ·å¦ (æ¨¡æ“¬ 6 çˆ») -> æ‰¾å‡ºä¸–çˆ»
        // ç°¡åŒ–ï¼šç›´æ¥éš¨æ©Ÿç”¢ç”Ÿä¸€å€‹ã€Œä¸–çˆ»åœ°æ”¯ã€
        // (åœ¨å®Œæ•´ç‰ˆæ˜¯ï¼šéš¨æ©Ÿå¦ -> æŸ¥è¡¨å¾—ä¸–çˆ» -> å¾—åœ°æ”¯ã€‚é€™è£¡MVPç›´æ¥æŠ½åœ°æ”¯ï¼Œæ•ˆæœä¸€æ¨£)
        const randBranch = branches[Math.floor(Math.random() * 12)]; 
        const element = wxMap[randBranch]; // æŸ¥äº”è¡Œ

        // 2. æ±ºå®šç¥ç¸ (ä¾æ“šä»Šæ—¥æ—¥å¹²)
        // ç”²ä¹™(0,1)èµ·é’é¾(0)...
        const dayIdx = stems.indexOf(todayGan);
        const startBeastIdx = [0,0,1,1,2,3,4,4,5,5][dayIdx]; // å…­ç¸èµ·ä¾‹å£è¨£
        // å‡è¨­ä¸–çˆ»åœ¨ç¬¬å¹¾çˆ»ï¼Ÿ(éš¨æ©Ÿ 1-6)
        const shiPos = Math.floor(Math.random() * 6); 
        const beastIdx = (startBeastIdx + shiPos) % 6;
        const myBeast = animals[beastIdx];

        // 3. çµ„åˆé›…å
        const artName = nameDB[myBeast][element] || `${element}è¡Œ${myBeast}`;
        
        // 4. æ¸²æŸ“
        document.getElementById('rIcon').innerText = iconDB[myBeast];
        document.getElementById('rName').innerText = artName;
        document.getElementById('rDayGan').innerText = todayGan;
        document.getElementById('rBranch').innerText = `${randBranch} (${element})`;
        
        document.getElementById('rDesc').innerText = `æœ¬å‘½ç¥ç¸ç‚ºã€${myBeast}ã€‘ï¼Œè½åœ¨ã€${element}ã€‘åœ°ã€‚${descDB[element]} å±•ç¾å‡º${myBeast}çš„ç‰¹è³ªã€‚`;
        
        // é‡‘å¥åº« (éš¨æ©Ÿ)
        const quotes = [
            "ã€Œè¬ç‰©çš†æœ‰æ™‚ï¼Œä½ çš„å…‰èŠ’çµ‚å°‡è¢«çœ‹è¦‹ã€‚ã€",
            "ã€Œå‹•éœæœ‰æ™‚ï¼Œé©æ™‚çš„è½‰èº«æ˜¯ç‚ºäº†èµ°æ›´é•·é çš„è·¯ã€‚ã€",
            "ã€Œå…‰èŠ’é›–ç¾äº¦éœ€ç‡ˆæ²¹ï¼Œä¿æŒå…§å¿ƒå¹³éœã€‚ã€",
            "ã€Œäº¢é¾æœ‰æ‚”ï¼Œå­¸ç¿’åœ¨é«˜å³°æ™‚ä½é ­ã€‚ã€",
            "ã€Œåœ°å‹¢å¤ï¼Œå›å­ä»¥åšå¾·è¼‰ç‰©ã€‚ã€"
        ];
        document.getElementById('rQuote').innerText = quotes[Math.floor(Math.random()*quotes.length)];

        document.getElementById('loading').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
    }

    // --- 4. æˆªåœ–ä¸‹è¼‰åŠŸèƒ½ (æ ¸å¿ƒåƒ¹å€¼) ---
    function downloadCard() {
        const card = document.getElementById('capture-card');
        const btn = document.querySelector('.btn-download');
        btn.innerText = "â³ è™•ç†ä¸­...";
        
        html2canvas(card, {
            scale: 2, // é«˜è§£æåº¦
            backgroundColor: "#141414", // ç¢ºä¿èƒŒæ™¯è‰²æ­£ç¢º
            useCORS: true // å…è¨±è·¨åŸŸåœ–ç‰‡
        }).then(canvas => {
            // å»ºç«‹ä¸‹è¼‰é€£çµ
            const link = document.createElement('a');
            link.download = `ä»™äººæŒ‡è·¯_${document.getElementById('rName').innerText}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
            btn.innerText = "ğŸ“¥ ä¸‹è¼‰ç¥ç¸å¡";
        });
    }

    // å•Ÿå‹•
    initDate();

</script>
</body>
</html>

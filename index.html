<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä»™äººæŒ‡è·¯ - V72.0 (IGç¥ç¸å¡â€§ä¸€éµä¸‹è¼‰ç‰ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --bg: #050505;
            --card-bg: #141414;
            --gold: #d4af37;
            --gold-light: #f1c40f;
            --blue: #2980b9;
            --text: #eee;
        }
        body {
            font-family: "Microsoft JhengHei", "Heiti TC", serif;
            background-color: var(--bg); color: var(--text);
            margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        /* --- 1. é¦–é  (Landing) --- */
        #landing { text-align: center; padding: 40px 20px; width: 100%; max-width: 400px; margin-top: 10vh; }
        .logo { width: 120px; margin-bottom: 20px; filter: drop-shadow(0 0 10px rgba(212,175,55,0.4)); }
        .title { font-size: 32px; font-weight: 900; color: var(--gold); margin-bottom: 5px; letter-spacing: 2px; }
        .sub { font-size: 14px; color: #888; margin-bottom: 40px; }
        
        .date-badge { 
            background: #222; border: 1px solid #444; color: var(--gold); 
            padding: 8px 15px; border-radius: 20px; font-size: 14px; margin-bottom: 30px; display: inline-block;
        }

        .btn-main {
            background: linear-gradient(135deg, #b8860b, #d4af37);
            color: #000; font-size: 20px; font-weight: bold;
            padding: 15px 0; width: 100%; border: none; border-radius: 50px;
            cursor: pointer; box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
            animation: pulse 2s infinite;
        }
        .btn-main:active { transform: scale(0.98); }

        /* --- 2. è®€å–å‹•ç•« --- */
        #loading { display: none; margin-top: 30vh; text-align: center; }
        .spinner { width: 50px; height: 50px; border: 5px solid #333; border-top: 5px solid var(--gold); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }

        /* --- 3. çµæœå€ (åŒ…å«æˆªåœ–å¡ç‰‡) --- */
        #result-area { display: none; padding: 20px; width: 100%; max-width: 400px; box-sizing: border-box; }

        /* â˜… é‡é»ï¼šé€™å¼µå¡ç‰‡æ˜¯ç”¨ä¾†æˆªåœ–çš„ï¼Œè¨­è¨ˆè¦ç²¾ç¾ â˜… */
        #capture-card {
            background-color: var(--card-bg); /* ç¢ºä¿æˆªåœ–æœ‰åº•è‰² */
            background-image: radial-gradient(circle at 50% 0%, #2a2a2a 0%, #141414 70%);
            border: 4px double var(--gold);
            border-radius: 20px; 
            padding: 40px 25px; 
            text-align: center;
            position: relative; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            margin-bottom: 20px;
        }

        .card-logo { height: 40px; opacity: 0.8; margin-bottom: 20px; }
        
        .beast-icon {
            width: 120px; height: 120px; margin: 0 auto 15px auto;
            border: 3px solid var(--gold); border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 60px; background: #000;
            box-shadow: 0 0 25px rgba(212, 175, 55, 0.3);
        }

        .r-name { 
            font-size: 42px; font-weight: 900; color: var(--gold); 
            margin: 10px 0; font-family: "KaiTi", serif; letter-spacing: 4px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .r-tags { display: flex; justify-content: center; gap: 10px; margin-bottom: 25px; }
        .tag { background: #222; color: #aaa; padding: 4px 10px; border-radius: 4px; font-size: 12px; border: 1px solid #444; }
        .tag-gold { border-color: var(--gold); color: var(--gold); }

        .r-box { 
            text-align: left; background: rgba(255,255,255,0.05); 
            padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid var(--gold);
        }
        .r-title { color: var(--gold); font-size: 14px; font-weight: bold; margin-bottom: 8px; }
        .r-text { font-size: 15px; color: #ddd; line-height: 1.6; text-align: justify; }

        .r-guide { 
            font-size: 18px; font-weight: bold; color: #fff; font-style: italic; 
            margin-top: 30px; padding-top: 20px; border-top: 1px dashed #444;
            text-shadow: 0 2px 5px #000;
        }

        .card-footer { margin-top: 30px; font-size: 12px; color: #666; letter-spacing: 1px; }

        /* æŒ‰éˆ•å€ */
        .btn-download {
            background: #fff; color: #000; font-size: 18px; font-weight: bold;
            padding: 15px 0; width: 100%; border: none; border-radius: 50px;
            cursor: pointer; margin-bottom: 15px; display: flex; justify-content: center; align-items: center; gap: 8px;
            box-shadow: 0 5px 15px rgba(255,255,255,0.2);
        }
        .btn-retry {
            background: transparent; color: #888; border: 1px solid #444;
            padding: 10px 30px; border-radius: 20px; cursor: pointer; font-size: 14px;
        }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(212,175,55,0.4); } 70% { box-shadow: 0 0 0 20px rgba(212,175,55,0); } 100% { box-shadow: 0 0 0 0 rgba(212,175,55,0); } }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="landing">
        <img src="logo.png" alt="Logo" class="logo">
        <div class="title">ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼</div>
        <div class="sub">ä»™äººæŒ‡è·¯ Â· æ¢ç´¢æ‚¨çš„éˆé­‚åŸå‹</div>
        
        <div class="date-badge" id="todayInfo">æ­£åœ¨é€£çµå¤©æ™‚...</div>

        <button class="btn-main" onclick="startTest()">ğŸ”® ç«‹å³æ¸¬é©—</button>
        <p style="margin-top:20px; font-size:12px; color:#555;">ä»Šæ—¥å·²æœ‰ 892 äººé ˜å–æŒ‡å¼•</p>
    </div>

    <div id="loading">
        <div class="spinner"></div>
        <p style="color:var(--gold);">æ­£åœ¨åˆ†æå¤©å¹²åœ°æ”¯...</p>
    </div>

    <div id="result-area">
        
        <div id="capture-card">
            <img src="logo.png" class="card-logo">
            
            <div class="beast-icon" id="rIcon">ğŸ‰</div>
            <h1 class="r-name" id="rName">æ»„æµ·é’é¾</h1>
            
            <div class="r-tags">
                <span class="tag tag-gold" id="rDate">2026.01.06</span>
                <span class="tag" id="rDayGan">æ—¥å¹²:ç”²</span>
                <span class="tag" id="rBranch">ä¸–çˆ»:å­æ°´</span>
            </div>

            <div class="r-box">
                <div class="r-title">âš”ï¸ æ€§æ ¼åŸå‹</div>
                <div class="r-text" id="rDesc">
                    å¦‚æ·±æ½›æ–¼æ»„æµ·ä¹‹ä¸­çš„é¾ï¼Œå¤–è¡¨å¹³éœï¼Œå…§å¿ƒæ¹§å‹•è‘—å¼·å¤§èƒ½é‡ã€‚å–„æ–¼è§€å¯Ÿå±€å‹¢ï¼Œç­‰å¾…æ™‚æ©Ÿä¸€é£›æ²–å¤©ã€‚
                </div>
            </div>

            <div class="r-box" style="border-left-color:var(--blue); background:rgba(41, 128, 185, 0.1);">
                <div class="r-title" style="color:var(--blue);">âœ¨ é˜¿é’å¸«æŒ‡å¼•</div>
                <div class="r-text" id="rAdvice">
                    æ°´èƒ½è¼‰èˆŸäº¦èƒ½è¦†èˆŸã€‚ä½ çš„æ™ºæ…§æ˜¯é›™é¢åˆƒï¼Œå¤šä¸€é»çœŸèª ï¼Œé‹å‹¢å°‡å¦‚æµ·ç´ç™¾å·ã€‚
                </div>
            </div>

            <div class="r-guide" id="rQuote">ã€Œæ½›é¾å‹¿ç”¨ï¼Œé™½æ°£æ½›è—ã€‚ã€</div>
            
            <div class="card-footer">
                ä»™äººæŒ‡è·¯å åœç ”ç©¶å­¸æœƒ Â· å°ˆå±¬å‘½æ›¸
            </div>
        </div>
        <button class="btn-download" onclick="downloadCard()">ğŸ“¸ ä¸‹è¼‰ç¥ç¸å¡ (ç™¼IG)</button>
        <div style="text-align:center;">
            <button class="btn-retry" onclick="location.reload()">â†º é‡æ–°æ¸¬é©—</button>
        </div>
    </div>

<script>
    // --- 1. å¤©æ™‚ç³»çµ± (è‡ªå‹•æŠ“æ—¥å¹²) ---
    const stems = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
    const branches = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
    const animals = ["é’é¾","æœ±é›€","å‹¾é™³","è£è›‡","ç™½è™","ç„æ­¦"];
    
    const wxMap = {
        "å­":"æ°´", "äº¥":"æ°´", "å¯…":"æœ¨", "å¯":"æœ¨", "å·³":"ç«", "åˆ":"ç«",
        "è¾°":"æ¿•åœŸ", "æˆŒ":"ç‡¥åœŸ", "ä¸‘":"æ¿•åœŸ", "æœª":"ç‡¥åœŸ", "ç”³":"é‡‘", "é…‰":"é‡‘"
    };

    let todayGan = ""; 
    let todayStr = "";

    function initDate() {
        const now = new Date();
        const y = now.getFullYear();
        const m = now.getMonth() + 1;
        const d = now.getDate();
        
        // ç°¡æ˜“æ—¥å¹²æ”¯å…¬å¼ (åŸºæº– 2024/1/1 = ç”²å­)
        const base = new Date(2024, 0, 1);
        const diff = Math.round((new Date(y, m-1, d) - base) / 86400000);
        let idx = diff % 60; if(idx < 0) idx += 60;
        
        todayGan = stems[idx % 10]; // å–å¾—ä»Šæ—¥å¤©å¹²
        const todayZhi = branches[idx % 12];
        
        todayStr = `${y}.${String(m).padStart(2,'0')}.${String(d).padStart(2,'0')}`;
        document.getElementById('todayInfo').innerText = `ğŸ“… ä»Šæ—¥ï¼š${todayGan}${todayZhi}æ—¥ (ç¥ç¸ä¾æ­¤æ’å¸ƒ)`;
        document.getElementById('rDate').innerText = todayStr;
        document.getElementById('rDayGan').innerText = `æ—¥å¹²: ${todayGan}`;
    }

    // --- 2. 72å‹ é›…åè³‡æ–™åº« ---
    const nameDB = {
        "é’é¾": { "æ°´":"æ»„æµ·é’é¾", "æ¿•åœŸ":"ç›¤é¾è‡¥é‡", "ç‡¥åœŸ":"é®å±±é’é¾", "æœ¨":"é›²æ—é’é¾", "ç«":"é¨°é›²é’é¾", "é‡‘":"åŠè„Šé’é¾" },
        "æœ±é›€": { "æ°´":"æ˜ æ³¢æœ±é›€", "æ¿•åœŸ":"æ£²æ¢§æœ±é›€", "ç‡¥åœŸ":"ä¸¹å±±æœ±é›€", "æœ¨":"éŠœææœ±é›€", "ç«":"æ¶…æ§ƒæœ±é›€", "é‡‘":"æµé‡‘æœ±é›€" },
        "å‹¾é™³": { "æ°´":"æ·±æ½­å‹¾é™³", "æ¿•åœŸ":"åšå¾·å‹¾é™³", "ç‡¥åœŸ":"é®å¶½å‹¾é™³", "æœ¨":"å¤æœ¨å‹¾é™³", "ç«":"ç…‰åœŸå‹¾é™³", "é‡‘":"æŠ«ç”²å‹¾é™³" },
        "è£è›‡": { "æ°´":"é›²éœ§è£è›‡", "æ¿•åœŸ":"éåœ°è£è›‡", "ç‡¥åœŸ":"è’æ¼ è£è›‡", "æœ¨":"ç¿ æ—è£è›‡", "ç«":"å¹»ç«è£è›‡", "é‡‘":"é‡‘é±—è£è›‡" },
        "ç™½è™": { "æ°´":"éœœé›ªç™½è™", "æ¿•åœŸ":"ä¼é‡ç™½è™", "ç‡¥åœŸ":"æ› é‡ç™½è™", "æœ¨":"ä¼æ—ç™½è™", "ç«":"çƒˆç„°ç™½è™", "é‡‘":"è‚…æ®ºç™½è™" },
        "ç„æ­¦": { "æ°´":"æ·±æ·µç„æ­¦", "æ¿•åœŸ":"ç„å†¥ç„æ­¦", "ç‡¥åœŸ":"å²©ç”²ç„æ­¦", "æœ¨":"éš±æ—ç„æ­¦", "ç«":"é™°ç«ç„æ­¦", "é‡‘":"éµå£ç„æ­¦" }
    };

    const descDB = {
        "æ°´": "æ“æœ‰å¦‚æ°´èˆ¬çš„é©æ‡‰åŠ›ï¼Œå–„æ–¼æ‡‰å°è®ŠåŒ–ï¼Œæ™ºæ…§æ·±æ²‰ä½†æœ‰æ™‚æ€æ…®éé‡ã€‚",
        "æ¿•åœŸ": "æ€§æ ¼æº«æ½¤åŒ…å®¹ï¼Œå–„æ–¼æ»‹é¤Šä»–äººï¼Œä½†æœ‰æ™‚éæ–¼è¢«å‹•ï¼Œéœ€ä¸»å‹•å‡ºæ“Šã€‚",
        "ç‡¥åœŸ": "æ€§æ ¼å …æ¯…ç©©é‡ï¼ŒåŸå‰‡æ€§å¼·ï¼Œå€¼å¾—ä¿¡è³´ï¼Œä½†æœ‰æ™‚ç¨é¡¯å›ºåŸ·ã€‚",
        "æœ¨": "å……æ»¿ç”Ÿæ©Ÿèˆ‡ä»æ„›ä¹‹å¿ƒï¼Œç©æ¥µå‘ä¸Šï¼Œå…·æœ‰é–‹å‰µåŠ›ï¼Œæ˜¯å¤©ç”Ÿçš„é ˜å°è€…ã€‚",
        "ç«": "æ•£ç™¼å…‰èˆ‡ç†±ï¼Œå…·æœ‰å¼·çƒˆæ„ŸæŸ“åŠ›ï¼Œç†±æƒ…å¥”æ”¾ä½†æƒ…ç·’èµ·ä¼å¤§ã€‚",
        "é‡‘": "é¢¨æ ¼çŠ€åˆ©æœæ–·ï¼ŒåŸ·è¡ŒåŠ›å¼·ï¼Œè¬›æ±‚æ•ˆç‡èˆ‡åŸå‰‡ï¼Œæ˜¯ç ´å±€çš„é—œéµã€‚"
    };

    const iconDB = {"é’é¾":"ğŸ‰", "æœ±é›€":"ğŸ¦…", "å‹¾é™³":"â›°ï¸", "è£è›‡":"ğŸ", "ç™½è™":"ğŸ¯", "ç„æ­¦":"ğŸ¢"};

    // --- 3. æ¸¬é©—é‚è¼¯ ---
    function startTest() {
        document.getElementById('landing').style.display = 'none';
        document.getElementById('loading').style.display = 'block';
        setTimeout(calcResult, 1500); // æ¨¡æ“¬é‹ç®— 1.5ç§’
    }

    function calcResult() {
        // 1. éš¨æ©Ÿæ±ºå®šä¸–çˆ»åœ°æ”¯ (æ¨¡æ“¬èµ·å¦çµæœ)
        const randBranch = branches[Math.floor(Math.random() * 12)]; 
        const element = wxMap[randBranch]; 

        // 2. æ±ºå®šç¥ç¸ (ä¾æ“šä»Šæ—¥æ—¥å¹²)
        // ç”²ä¹™(0,1)èµ·é’é¾... æˆŠ(4)èµ·å‹¾é™³, å·±(5)èµ·è£è›‡...
        const dayIdx = stems.indexOf(todayGan);
        // å…­ç¸èµ·ä¾‹å£è¨£ï¼šç”²ä¹™èµ·é’é¾ï¼Œä¸™ä¸æœ±é›€ï¼ŒæˆŠå‹¾é™³ï¼Œå·±è£è›‡ï¼Œåºšè¾›ç™½è™ï¼Œå£¬ç™¸ç„æ­¦
        const startBeastIdx = [0,0,1,1,2,3,4,4,5,5][dayIdx]; 
        
        // å‡è¨­ä¸–çˆ»åœ¨ç¬¬å¹¾çˆ»ï¼Ÿ(éš¨æ©Ÿ 1-6)
        const shiPos = Math.floor(Math.random() * 6); 
        const beastIdx = (startBeastIdx + shiPos) % 6;
        const myBeast = animals[beastIdx];

        // 3. çµ„åˆå…§å®¹
        const artName = nameDB[myBeast][element] || `${element}è¡Œ${myBeast}`;
        
        // æ¸²æŸ“
        document.getElementById('rIcon').innerText = iconDB[myBeast];
        document.getElementById('rName').innerText = artName;
        document.getElementById('rBranch').innerText = `ä¸–çˆ»:${randBranch}(${element})`;
        
        document.getElementById('rDesc').innerText = `æœ¬å‘½ç¥ç¸ç‚ºã€${myBeast}ã€‘ï¼Œè½åœ¨ã€${element}ã€‘åœ°ã€‚${descDB[element]} å±•ç¾å‡º${myBeast}çš„ç‰¹è³ªã€‚`;
        
        // éš¨æ©Ÿé‡‘å¥
        const quotes = [
            "ã€Œè¬ç‰©çš†æœ‰æ™‚ï¼Œä½ çš„å…‰èŠ’çµ‚å°‡è¢«çœ‹è¦‹ã€‚ã€",
            "ã€Œå‹•éœæœ‰æ™‚ï¼Œé©æ™‚çš„è½‰èº«æ˜¯ç‚ºäº†èµ°æ›´é•·é çš„è·¯ã€‚ã€",
            "ã€Œå…‰èŠ’é›–ç¾äº¦éœ€ç‡ˆæ²¹ï¼Œä¿æŒå…§å¿ƒå¹³éœã€‚ã€",
            "ã€Œäº¢é¾æœ‰æ‚”ï¼Œå­¸ç¿’åœ¨é«˜å³°æ™‚ä½é ­ã€‚ã€",
            "ã€Œåœ°å‹¢å¤ï¼Œå›å­ä»¥åšå¾·è¼‰ç‰©ã€‚ã€"
        ];
        document.getElementById('rQuote').innerText = quotes[Math.floor(Math.random()*quotes.length)];

        // åˆ‡æ›é¡¯ç¤º
        document.getElementById('loading').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
    }

    // --- 4. æˆªåœ–ä¸‹è¼‰ (é—œéµä¿®æ­£) ---
    function downloadCard() {
        const card = document.getElementById('capture-card');
        const btn = document.querySelector('.btn-download');
        const originalText = btn.innerText;
        btn.innerText = "â³ æ­£åœ¨ç”Ÿæˆç²¾ç¾å¡ç‰‡...";
        
        html2canvas(card, {
            scale: 2, // 2å€è§£æåº¦ï¼Œç¢ºä¿æ¸…æ™°
            backgroundColor: "#141414", // ç¢ºä¿èƒŒæ™¯ä¸æ˜¯é€æ˜
            useCORS: true, // å…è¨±è®€å– Logo
            logging: false
        }).then(canvas => {
            // å»ºç«‹ä¸‹è¼‰é€£çµ
            const link = document.createElement('a');
            link.download = `ä»™äººæŒ‡è·¯_${document.getElementById('rName').innerText}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
            btn.innerText = originalText;
        }).catch(err => {
            alert("æˆªåœ–å¤±æ•—ï¼Œè«‹æ‰‹å‹•æˆªåœ–ã€‚\n" + err);
            btn.innerText = originalText;
        });
    }

    // å•Ÿå‹•åˆå§‹åŒ–
    initDate();

</script>
</body>
</html>
